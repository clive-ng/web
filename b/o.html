<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Museum Navigator</title>

<style>
body {
  font-family: sans-serif;
  text-align: center;
  padding: 20px;
  transition: background-color 0.5s;
}

h1 { font-size: 26px; }

.hidden { display: none; }

#card {
  margin-top: 20px;
  padding: 20px;
  border-radius: 12px;
  border: 2px solid #28a745;
  background: white;
}

#proximityBarContainer {
  width: 100%;
  height: 18px;
  background: #ddd;
  border-radius: 10px;
  margin-top: 15px;
}

#proximityBar {
  height: 100%;
  width: 0%;
  border-radius: 10px;
  background: #28a745;
  transition: width 0.4s ease;
}

button {
  padding: 14px 24px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  background: #007BFF;
  color: white;
  cursor: pointer;
}
</style>
</head>
<body>

<h1>Smart Museum Navigator</h1>
<p id="status">Scanning for nearby exhibits...</p>

<div id="card" class="hidden">
  <h2 id="exhibitTitle"></h2>
  <p id="exhibitText"></p>

  <div id="proximityBarContainer">
    <div id="proximityBar"></div>
  </div>

  <button onclick="playAudio()">ðŸ”Š Play Audio Guide</button>
</div>

<script>
// ---------------- EXHIBIT DATABASE ----------------
const exhibits = {
  "Dinosaur_Zone_Node": {
    title: "Dinosaurs",
    text: "Turn left for the T-Rex skeleton, or continue ahead for Triceratops.",
    audio: "dinosaur.mp3"
  },
  "Space_Zone_Node": {
    title: "Space Exploration",
    text: "Explore lunar landing technology and Mars rover engineering.",
    audio: "space.mp3"
  },
  "Ocean_Zone_Node": {
    title: "Ocean Life",
    text: "Discover deep sea creatures and coral ecosystems.",
    audio: "ocean.mp3"
  }
};

let currentDevice = null;
let proximityTimer = null;
let visitLog = [];

// ---------- AUTO SCAN ----------
async function scan() {
  try {
    const device = await navigator.bluetooth.requestDevice({
      acceptAllDevices: true
    });

    if (exhibits[device.name]) {
      connect(device);
    }

  } catch (e) {
    document.getElementById("status").innerText =
      "Tap screen to enable Bluetooth scanning.";
  }
}

async function connect(device) {
  currentDevice = device;
  await device.gatt.connect();

  showExhibit(device.name);

  device.addEventListener('gattserverdisconnected', () => {
    resetUI();
  });
}

// ---------- UI DISPLAY ----------
function showExhibit(name) {
  const exhibit = exhibits[name];

  document.body.style.backgroundColor = "#d4edda";
  document.getElementById("card").classList.remove("hidden");

  document.getElementById("exhibitTitle").innerText = exhibit.title;
  document.getElementById("exhibitText").innerText = exhibit.text;

  document.getElementById("status").innerText =
    "Viewing: " + exhibit.title;

  logVisit(name);

  startProximityBar();
}

// ---------- PROXIMITY BAR ----------
function startProximityBar() {
  const bar = document.getElementById("proximityBar");
  let value = 20;

  proximityTimer = setInterval(() => {
    value += 20;
    if (value > 100) value = 20;
    bar.style.width = value + "%";
  }, 1500);
}

function stopProximityBar() {
  clearInterval(proximityTimer);
  document.getElementById("proximityBar").style.width = "0%";
}

// ---------- AUDIO GUIDE ----------
function playAudio() {
  if (!currentDevice) return;
  const exhibit = exhibits[currentDevice.name];
  const audio = new Audio(exhibit.audio);
  audio.play();
}

// ---------- VISITOR ANALYTICS ----------
function logVisit(exhibitName) {
  const entry = {
    exhibit: exhibitName,
    time: new Date().toLocaleTimeString()
  };

  visitLog.push(entry);
  console.log("Visitor Log:", visitLog);
}

// ---------- RESET ----------
function resetUI() {
  stopProximityBar();

  document.body.style.backgroundColor = "white";
  document.getElementById("card").classList.add("hidden");
  document.getElementById("status").innerText =
    "Searching for nearby exhibits...";
}

// start scanning on load
scan();
</script>
</body>
</html>
