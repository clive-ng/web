<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Side-by-Side Image Merger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .dashed-border {
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='8' ry='8' stroke='%23CBD5E1FF' stroke-width='2' stroke-dasharray='8%2c 8' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }
        .dashed-border:hover {
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='8' ry='8' stroke='%2394A3B8FF' stroke-width='2' stroke-dasharray='8%2c 8' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen p-4 md:p-8">

    <div class="max-w-4xl mx-auto space-y-8">
        <!-- Header -->
        <div class="text-center space-y-2">
            <h1 class="text-3xl font-bold tracking-tight text-slate-800">Side-by-Side Image Merger</h1>
            <p class="text-slate-500">Upload two images. The merged file will download automatically.</p>
        </div>

        <!-- Upload Area -->
        <div class="grid md:grid-cols-2 gap-6">
            
            <!-- Left Image -->
            <div class="space-y-3">
                <label class="block text-sm font-medium text-slate-700">Left Image (Part A)</label>
                <div class="relative group">
                    <input type="file" id="inputA" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" onchange="handleUpload('A')">
                    <div id="previewA-container" class="dashed-border rounded-xl bg-white p-6 h-64 flex flex-col items-center justify-center text-center transition-all">
                        <i data-lucide="image-plus" class="w-10 h-10 text-slate-400 mb-3 group-hover:text-slate-500 transition-colors"></i>
                        <p class="text-sm text-slate-500 font-medium">Click or Drag Image Here</p>
                        <p id="filenameA" class="text-xs text-slate-400 mt-1 truncate max-w-[200px] opacity-0">filename.jpg</p>
                    </div>
                    <img id="previewA-img" class="absolute inset-0 w-full h-full object-contain rounded-xl bg-slate-100 hidden pointer-events-none" />
                    <button id="clearA" onclick="clearImage('A')" class="absolute top-2 right-2 bg-white/90 p-1.5 rounded-full shadow-sm hover:bg-red-50 hover:text-red-500 transition-all hidden z-20">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>

            <!-- Right Image -->
            <div class="space-y-3">
                <label class="block text-sm font-medium text-slate-700">Right Image (Part B)</label>
                <div class="relative group">
                    <input type="file" id="inputB" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" onchange="handleUpload('B')">
                    <div id="previewB-container" class="dashed-border rounded-xl bg-white p-6 h-64 flex flex-col items-center justify-center text-center transition-all">
                        <i data-lucide="image-plus" class="w-10 h-10 text-slate-400 mb-3 group-hover:text-slate-500 transition-colors"></i>
                        <p class="text-sm text-slate-500 font-medium">Click or Drag Image Here</p>
                        <p id="filenameB" class="text-xs text-slate-400 mt-1 truncate max-w-[200px] opacity-0">filename.jpg</p>
                    </div>
                    <img id="previewB-img" class="absolute inset-0 w-full h-full object-contain rounded-xl bg-slate-100 hidden pointer-events-none" />
                    <button id="clearB" onclick="clearImage('B')" class="absolute top-2 right-2 bg-white/90 p-1.5 rounded-full shadow-sm hover:bg-red-50 hover:text-red-500 transition-all hidden z-20">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Controls & Output -->
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-6">
            <div class="flex flex-col sm:flex-row justify-between items-center gap-4 border-b border-slate-100 pb-6">
                <div class="flex items-center space-x-2">
                   <label class="flex items-center space-x-2 text-sm text-slate-600 cursor-pointer select-none">
                        <input type="checkbox" id="matchHeight" class="w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500" checked onchange="mergeImages()">
                        <span>Auto-scale to match height</span>
                   </label>
                </div>
                
                <div class="flex items-center gap-2 w-full sm:w-auto">
                    <button onclick="resetAll()" class="px-5 py-2.5 rounded-lg font-medium text-sm text-slate-600 hover:bg-slate-100 border border-transparent hover:border-slate-200 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                        Reset
                    </button>
                    <button onclick="mergeImages()" class="flex-1 sm:flex-none bg-slate-800 hover:bg-slate-900 text-white px-5 py-2.5 rounded-lg font-medium text-sm transition-colors flex items-center justify-center gap-2">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        Generate Preview
                    </button>
                </div>
            </div>

            <!-- Canvas Container -->
            <div id="resultContainer" class="hidden space-y-4">
                <div class="flex flex-col items-center space-y-2">
                    <h3 class="text-sm font-medium text-slate-500 uppercase tracking-wider">Preview</h3>
                    <div class="relative w-full overflow-hidden bg-slate-100 rounded-lg border border-slate-200 flex justify-center p-2">
                         <canvas id="mergeCanvas" class="max-w-full h-auto shadow-sm"></canvas>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 items-end justify-between pt-2">
                    <div class="w-full sm:w-64 space-y-1">
                        <label class="text-xs font-semibold text-slate-500 uppercase">Output Filename</label>
                        <div class="flex items-center relative">
                            <input type="text" id="outputFilename" value="merged-image.jpg" class="w-full pl-3 pr-10 py-2 border border-slate-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <span class="absolute right-3 text-slate-400 text-xs">.jpg</span>
                        </div>
                    </div>
                    <button onclick="downloadImage()" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white px-6 py-2.5 rounded-lg font-medium text-sm shadow-sm transition-colors flex items-center justify-center gap-2">
                        <i data-lucide="download" class="w-4 h-4"></i>
                        Download Result
                    </button>
                </div>
            </div>
            
            <div id="emptyState" class="text-center py-12 text-slate-400">
                <p>Select both images to see the preview.</p>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        let imageA = null;
        let imageB = null;
        let fileA = null;
        let fileB = null;

        function handleUpload(side) {
            const input = document.getElementById(`input${side}`);
            const file = input.files[0];
            if (!file) return;

            if (side === 'A') fileA = file;
            else fileB = file;

            // Update UI Filename
            const filenameEl = document.getElementById(`filename${side}`);
            filenameEl.textContent = file.name;
            filenameEl.classList.remove('opacity-0');

            // Read and Preview
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    if (side === 'A') imageA = img;
                    else imageB = img;

                    // Show visual preview
                    const previewImg = document.getElementById(`preview${side}-img`);
                    previewImg.src = e.target.result;
                    previewImg.classList.remove('hidden');
                    
                    // Hide placeholder container text
                    document.getElementById(`preview${side}-container`).classList.add('opacity-0');
                    
                    // Show clear button
                    document.getElementById(`clear${side}`).classList.remove('hidden');

                    // Try to auto-generate
                    attemptMerge();
                }
                img.src = e.target.result;
            }
            reader.readAsDataURL(file);
        }

        function clearImage(side) {
            const input = document.getElementById(`input${side}`);
            input.value = "";
            
            if (side === 'A') {
                imageA = null;
                fileA = null;
            } else {
                imageB = null;
                fileB = null;
            }

            // Reset UI
            document.getElementById(`preview${side}-img`).classList.add('hidden');
            document.getElementById(`preview${side}-img`).src = "";
            document.getElementById(`preview${side}-container`).classList.remove('opacity-0');
            document.getElementById(`filename${side}`).classList.add('opacity-0');
            document.getElementById(`clear${side}`).classList.add('hidden');

            // Hide result if incomplete
            document.getElementById('resultContainer').classList.add('hidden');
            document.getElementById('emptyState').classList.remove('hidden');
        }

        function attemptMerge() {
            if (imageA && imageB) {
                determineFilename();
                mergeImages();
                downloadImage();
            }
        }

        function determineFilename() {
            if (!fileA || !fileB) return;

            const nameA = fileA.name.substring(0, fileA.name.lastIndexOf('.')) || fileA.name;
            const nameB = fileB.name.substring(0, fileB.name.lastIndexOf('.')) || fileB.name;

            // Logic to find common base name
            // Regex checks for a trailing 'a' or 'b' (case insensitive), possibly preceded by -, _, or space
            // Pattern: Capture everything before the suffix
            // Example: o15a -> o15, image-1a -> image-1
            
            const regexA = /^(.*?)[\-_ ]?a$/i;
            const regexB = /^(.*?)[\-_ ]?b$/i;
            
            const matchA = nameA.match(regexA);
            const matchB = nameB.match(regexB);

            let finalName = "merged-image";

            if (matchA && matchB && matchA[1].toLowerCase() === matchB[1].toLowerCase()) {
                // Perfect match (e.g. o15a & o15b -> o15)
                finalName = matchA[1];
            } else {
                // Fallback: Check if they are just "1" and "2"
                const regex1 = /^(.*?)[\-_ ]?1$/;
                const regex2 = /^(.*?)[\-_ ]?2$/;
                const m1 = nameA.match(regex1);
                const m2 = nameB.match(regex2);
                
                if (m1 && m2 && m1[1] === m2[1]) {
                    finalName = m1[1];
                } else if (nameA.length > 3 && nameB.startsWith(nameA.substring(0, nameA.length - 1))) {
                     // Heuristic: if they share a very long prefix
                     finalName = nameA.substring(0, nameA.length - 1);
                }
            }

            document.getElementById('outputFilename').value = finalName;
        }

        function mergeImages() {
            if (!imageA || !imageB) return;

            const canvas = document.getElementById('mergeCanvas');
            const ctx = canvas.getContext('2d');
            const matchHeight = document.getElementById('matchHeight').checked;

            let w1 = imageA.width;
            let h1 = imageA.height;
            let w2 = imageB.width;
            let h2 = imageB.height;

            let drawW1 = w1;
            let drawH1 = h1;
            let drawW2 = w2;
            let drawH2 = h2;

            if (matchHeight) {
                // If we match height, we usually scale to the taller one to preserve quality, 
                // or shorter one to save space? Let's scale to the TALLER one so we don't lose res.
                // Actually, standard practice for simple mergers is often finding a common height.
                // Let's pick the height of Image A as the master, or the max.
                // Let's use MAX height.
                
                const targetH = Math.max(h1, h2);
                
                if (h1 !== targetH) {
                    const scale = targetH / h1;
                    drawW1 = w1 * scale;
                    drawH1 = targetH;
                }
                
                if (h2 !== targetH) {
                    const scale = targetH / h2;
                    drawW2 = w2 * scale;
                    drawH2 = targetH;
                }
            }

            // Set canvas size
            canvas.width = drawW1 + drawW2;
            canvas.height = Math.max(drawH1, drawH2);

            // Draw Background (white) in case of transparency or mismatch
            ctx.fillStyle = "#FFFFFF";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Images
            ctx.drawImage(imageA, 0, 0, drawW1, drawH1);
            ctx.drawImage(imageB, drawW1, 0, drawW2, drawH2);

            // Show UI
            document.getElementById('resultContainer').classList.remove('hidden');
            document.getElementById('emptyState').classList.add('hidden');
        }

        function downloadImage() {
            const canvas = document.getElementById('mergeCanvas');
            const filenameInput = document.getElementById('outputFilename').value || "merged";
            const fullFilename = filenameInput.endsWith('.jpg') ? filenameInput : filenameInput + ".jpg";

            // Convert to JPG
            const imageURL = canvas.toDataURL("image/jpeg", 0.95);

            const link = document.createElement('a');
            link.href = imageURL;
            link.download = fullFilename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function resetAll() {
            clearImage('A');
            clearImage('B');
            document.getElementById('outputFilename').value = "merged-image.jpg";
            document.getElementById('matchHeight').checked = true;
        }
    </script>
</body>
</html>